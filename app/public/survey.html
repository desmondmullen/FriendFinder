<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <title>Friend Finder Survey</title>
    <meta name='description' content='Friend Finder Survey'>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css'>
    <script src='https://code.jquery.com/jquery.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js'></script>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css'>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>

<body>
    <div id='survey' class='container'>
        <h2>Survey Questions</h2>
        <hr>
        <h3><strong>About You</strong></h3>
        <h4>Name</h4>
        <input type='text' id='name' class='form-control' required>
        <h4>Link to Photo Image (<em>must be a small, square image or it will get distorted!</em>)</h4>
        <input type='text' id='photo' class='form-control' required>
        <h4>Age</h4>
        <input type='number' id='age' class='form-control' required>

        <h3><strong>What kind of friend are you looking for?</strong></h3>
        <h4>Let us know so we can do a better job selecting friends for you.</h4>
        <select class='chosen-select' id='whatKind'>
            <option value=''></option>
            <option value='1'>I'm a male looking for female friends</option>
            <option value='2'>I'm a female looking for male friends</option>
            <option value='3'>I'm a male looking for male friends</option>
            <option value='4'>I'm a female looking for female friends</option>
        </select>
        <hr>
        <h3><strong>Question 1</strong></h3>
        <h4 id='headline1'></h4>
        <select class='chosen-select' id='q1'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 2</strong></h3>
        <h4 id='headline2'></h4>
        <select class='chosen-select' id='q2'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 3</strong></h3>
        <h4 id='headline3'></h4>
        <select class='chosen-select' id='q3'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 4</strong></h3>
        <h4 id='headline4'></h4>
        <select class='chosen-select' id='q4'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 5</strong></h3>
        <h4 id='headline5'></h4>
        <select class='chosen-select' id='q5'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 6</strong></h3>
        <h4 id='headline6'></h4>
        <select class='chosen-select' id='q6'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 7</strong></h3>
        <h4 id='headline7'></h4>
        <select class='chosen-select' id='q7'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 8</strong></h3>
        <h4 id='headline8'></h4>
        <select class='chosen-select' id='q8'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 9</strong></h3>
        <h4 id='headline9'></h4>
        <select class='chosen-select' id='q9'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 10</strong></h3>
        <h4 id='headline10'></h4>
        <select class='chosen-select' id='q10'>
            <option value=''></option>
            <option value='1'>1 (Strongly Disagree)</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4'>4</option>
            <option value='5'>5 (Strongly Agree)</option>
        </select>
        <br><br>
        <button type='submit' class='btn btn-primary btn-lg btn-block' id='submit'><i class='fa fa-check-circle'
                aria-hidden='true'></i>
            Submit</button>
        <br>
    </div>
    <div id='results-modal' class='modal fade' role='dialog'>
        <div class='modal-dialog'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type='button' class='close' data-dismiss='modal'>&times;</button>
                    <h2 id='modal-title' class='modal-title'></h2>
                </div>
                <div id='modal-body' class='modal-body'>
                </div>
                <div id='modal-footer' class='modal-footer'></div>
            </div>
        </div>
    </div>
    <script type='text/javascript'>
        let theQuestions = ["My mind is always buzzing with unexplored ideas and plans.", "Generally speaking, I rely more on my experience than on my imagination.", "I find it easy to stay relaxed and focused even when there is some pressure.", "I rarely do something just out of sheer curiosity.", "People can rarely upset me.", "It is often difficult for me to relate to other people’s feelings.", "In a discussion, truth should be more important than people’s sensitivities.", "I rarely get carried away by fantasies and ideas.", "I think that everyone’s views should be respected regardless of whether they are supported by facts or not.", "I feel more energetic after spending time with a group of people."];

        let x = 1;
        theQuestions.forEach(element => {
            let theHeadline = `#headline${x}`;
            $(theHeadline).text(element);
            x++
        });

        let userData = {};
        let theMatchesModalTitle = '';
        let theMatchesModalString = '';

        $(document).on('click', '#compare', function (event) {
            var idToGet = { userID: event.target.name }
            $.post('/api/match', idToGet,
                function (data) {
                    theScores = data.scores;
                    theName = data.name;
                    thePhoto = data.photo;
                    let y = 0;
                    let theString = '';
                    let theComparison = '';
                    theScores.forEach(element => {
                        let theString = '';
                        let theStringEnd = '';
                        let theDifference = Math.abs(element - userData.scores[y]);
                        switch (theDifference) {
                            case 0:
                                theString = `<span class='green-text'>&nbsp;&nbsp;&nbsp;&nbsp;You both agree on this question!</span>`;
                                break;
                            case 1:
                                theStringEnd = 'a little more with this question.';
                                break;
                            case 2:
                                theStringEnd = 'more with this question.';
                                break;
                            case 3:
                                theStringEnd = 'a lot more with this question.';
                                break;
                            case 4:
                                theString = `<span class='red-text'>&nbsp;&nbsp;&nbsp;&nbsp;The two of you completely disagree on this question!</span>`;
                                break;
                            default:
                            // code block
                        }
                        if (element > userData.scores[y]) {
                            if (!theString) {
                                theString = `&nbsp;&nbsp;&nbsp;&nbsp;${theName} agrees ${theStringEnd}`;
                            };
                        } else {
                            if (!theString) {
                                theString = `&nbsp;&nbsp;&nbsp;&nbsp;${theName} disagrees ${theStringEnd}`;
                            };

                        };
                        theComparison += `<strong>"${theQuestions[y]}"</strong><br><em>${theString}<em><br><br>`;
                        y++
                    });
                    $('#modal-title').html(`<img src='${thePhoto}' class='float-left' width='80px'><section id='heres-how' class='float-left'>Here's how your answers<br>compare with ${theName}:</section>`);
                    $('#modal-body').html(theComparison);
                    $('#modal-footer').html(`
                    <button type='button' id='backToMatches' class='btn btn-default'>Back to Matches</button>
                    <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>
                    `);
                });
        });

        $(document).on('click', '#backToMatches', function (event) {
            $('#modal-title').text(theMatchesModalTitle);
            $('#modal-body').html(theMatchesModalString);
            $('#modal-footer').html(`
                <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>
            `);
        });

        function validateBeforeSubmit() {
            if ($('#name').val().length > 2 && $('#photo').val().length > 2 && $('#photo').val().length < 100 && $('#whatKind').val() != '' && $('#q1').val() != '' && $('#q2').val() != '' && $('#q3').val() != '' && $('#q4').val() != '' && $('#q5').val() != '' && $('#q6').val() != '' && $('#q7').val() != '' && $('#q8').val() != '' && $('#q9').val() != '' && $('#q10').val() != '') {
                return true;
            };
        };

        $('#submit').on('click', function (event) {
            event.preventDefault();
            const gender = 'male';
            const lookingFor = 'female';
            const whatKind = $('#whatKind').val();
            if (validateBeforeSubmit()) {
                let gender = '';
                let lookingFor = '';
                let whatKind = $('#whatKind').val();

                switch (parseInt(whatKind)) {
                    case 1:
                        gender = 'male';
                        lookingFor = 'female';
                        break;
                    case 2:
                        gender = 'female';
                        lookingFor = 'male';
                        break;
                    case 3:
                        gender = 'male';
                        lookingFor = 'male';
                        break;
                    case 4:
                        gender = 'female';
                        lookingFor = 'female';
                        break;
                    default:
                    // code block
                }
                userData = {
                    userID: new Date().getTime() + Math.floor(Math.random() * (9999 - 1111)) + 1111,
                    name: $('#name').val(),
                    age: $('#age').val(),
                    photo: $('#photo').val(),
                    whatKind: whatKind,
                    gender: gender,
                    lookingFor: lookingFor,
                    scores: [
                        $('#q1').val(),
                        $('#q2').val(),
                        $('#q3').val(),
                        $('#q4').val(),
                        $('#q5').val(),
                        $('#q6').val(),
                        $('#q7').val(),
                        $('#q8').val(),
                        $('#q9').val(),
                        $('#q10').val()
                    ]
                };

                $.post('/api/friends', userData,
                    function (data) {
                        if (data) {
                            theMatchesModalString = '';
                            data.forEach(element => {
                                let theDifference = (element.split(', '))[0];
                                theMatch = `
                            <section class='line-item'>
                                <img src='${element.split(', ')[3]}' class='img-results' height='128' width='128'>
                                <section class='ttl-results'>${element.split(', ')[1]}</section>
                                <p class='dsc-results'><strong>${Math.abs((((element.split(', ')[0]) / 40) - 1) * 100).toFixed(0)}% Match</strong><br>${element.split(', ')[2]} years old<br>Scores: ${element.split(', ')[4]}
                                    <br><button type='submit' id='compare' name='${element.split(', ')[5]}' class='button-modal'>Compare Scores</button>
                                </p>
                            </section>
                            <br>
                            `;
                                theMatchesModalString += theMatch;
                            });
                            theMatchesModalTitle = 'Here are your top 5 matches:';
                            $('#modal-title').text(theMatchesModalTitle);
                            $('#modal-body').html(theMatchesModalString);
                            $('#modal-footer').html(`
                    <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>
                        `);
                            $('#results-modal').modal('toggle');
                        }
                        else {
                            alert('no response');
                        }
                        $('#name').val('');
                        $('#photo').val('');
                        $('#age').val('');
                        $('#whatKind').val('');
                        $('#q1').val('');
                        $('#q2').val('');
                        $('#q3').val('');
                        $('#q4').val('');
                        $('#q5').val('');
                        $('#q6').val('');
                        $('#q7').val('');
                        $('#q8').val('');
                        $('#q9').val('');
                        $('#q10').val('');
                    });
            } else {
                alert('Please answer all the questions before clicking Submit.');
            };
        });
    </script>
</body>

</html>